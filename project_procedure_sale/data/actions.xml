<?xml version='1.0' encoding='UTF-8'?>
<odoo>

    <record id="create_tasks_procedure_when_sold" model="base.automation">
            <field name="name">=> Tasks procedure creation when sold </field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="active" eval="True"/>
            <field name="state">code</field>
            <field name="filter_domain">[('state','=','sale')]</field>
            <field name="code">
if (record.state == 'sale'):
  for pr in record.project_ids:
    if (pr.procedure_id.id) and (not pr.task_ids.ids):
      action = pr.sudo().create_case_tasks()
            </field>
            <field name="trigger">on_write</field>
    </record>

</odoo>
