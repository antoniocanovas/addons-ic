<?xml version='1.0' encoding='UTF-8'?>
<odoo>

       <record id="view_sale_order_special_discount" model="ir.ui.view">
        <field name="name">sale.order.special.discounts</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="groups_id" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
        <field name="arch" type="xml">
            <xpath expr="//page/field[@name='order_line']/.." position="after">
                <page string="Special discounts" name="special_discounts" attrs="{'invisible': [('state', 'not in', ['draft'])]}">
                    <group>
                        <field name="discount_type"/>
                        <field name="margin" attrs="{'invisible':[('discount_type','not in',['fixed_service_margin_over_cost','margin_over_cost'])]}"/>
                        <field name="price_our_service" attrs="{'invisible':[('discount_type','not in',['fixed_service_margin_over_cost'])]}"/>
                        <field name="target_price" attrs="{'invisible':[('discount_type','not in',['target_price'])]}"/>
                    </group>
                    <group>
                        <button class="oe_highlight oe_edit_only"
                                type="action"
                                name="%(sale_udo_discount.sale_order_recalculate_sd)d"
                                string="Recalculate"
                        />
                    </group>
                </page>
            </xpath>
        </field>
    </record>

</odoo>
